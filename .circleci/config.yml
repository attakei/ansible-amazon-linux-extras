version: 2

jobs:
  doclint:
    docker:
      - image: lexauw/ansible-alpine
        environment:
          ANSIBLE_LIBRARY: './src'
    steps:
      - run: ansible-doc -t module amazon_linux_extras
  pytest:
    docker:
      - image: circleci/python:2.7-node
        environment:
          PIPENV_VENV_IN_PROJECT: true
    steps:
      - checkout
      - run: |
          pip install --user pipenv
          pipenv install --dev
      - run: pipenv run pytest
  test:
    docker:
      - image: amazonlinux:2
    steps:
      - run: amazon-linux-extras install -y ansible2

workflows:
  version: 2
  test:
    jobs:
      - doclint
      - pytest
      - test
